# this

#### introduction

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// what is this ?


this 是运行时绑定的的，并不是在编写时绑定的

this 的上下文取决于函数调用时的各种条件

this 的绑定和函数声明位置没有关系，仅取决于函数的调用方式


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### es5 vs es6

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


var es5 = {

    count: 0,
    
    autoAdd: function() {
    
        var self = this;
        
        if(self.count < 1) {
        
            setTimeout(function(){
            
                self.count++;
                
            }, 100);
        }
    }
};


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


let es6 = {

    count: 0,
    
    autoAdd: () => {
    
        if(this.count < 1) {
        
            setTimeout(function(){
            
                this.count++;
                
            }, 100);
        }
    }
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### call/apply

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


function identifier() {

    console.log(this.name.toUpperCase());
}

funcution speak() {

    console.log(`Hello I'm ${identifier.call(this)}`);
}

var me = {
    
    name: 'alpha'

}, you = {

    name: 'beta'
};


identifier(me);                 // alpha
identifier(you);                // beta

speak.call(me);                 // Hello I'm alpha
speak.call(you);                // Hello I'm beta


//-------------------------------------------------------------------------------------------------------------------//


function () {

    arguments.calle();          // 调用自身匿名函数
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### this direction

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// this 的指向

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


1) this 在任何情况下都不指向函数的词法作用域

2) 在 javascript 内部，作用域确实和对象类似，可见的标示符号都是它的属性

3) "作用域 对象" 无法通过 javascript 代码访问，它存在于 javascript 引擎内部


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


fucntion write() {              // 书写位置

}

write();                        // 调用位置


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


// 调用位置( 利用调试工具 )


在当前作用域中，第一行打一个断点，运行代码时会在当前位置暂停，可以在旁边的的 调用栈中 的第二个元素就是其调用的位置


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### this binding

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


1) 由 new 调用？                    // 绑定到新创建的对象

2) 由 call/apply/bind 调用？        // 绑定到指定的对象

3) 由上下文对象调用？                // 绑定到那个上下文对象

4) 默认: 

    - 严格模式下:                    // 默认绑定到 undefined
    
    - 非严格模式:                    // 默认绑定到 window


* 优先级

    1) 显式绑定
    
    2) new绑定
    
    3) 隐式绑定
    
    4) 默认绑定


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


// 安全的忽略 this 绑定

Object.create(null);


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


() => {};                           // 不使用以上规则

根据当前词法作用域决定 this 的绑定

箭头函数会继承外层函数调用的 this 绑定


//-------------------------------------------------------------------------------------------------------------------//


// 默认绑定: 

    - 函数体是否处于严格: 默认绑定 undefined
    
    - 函数体是否处于非严格: 默认绑定 window 


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


function foo() {

    console.log(this.a);        // 非严格模式下: this 默认绑定 window
}

var a = 2;

foo();                          // a


function foo() {

    "use strict"

    console.log(this.a);        // 严格模式下: this 绑定规则取决于调用位置
}

var a = 2;

foo();                          // TypeError: this is undefined


//-------------------------------------------------------------------------------------------------------------------//

// 隐士绑定: 函数的调用被包裹在某个上下文中/函数调用位置是否存在于某个上下文中

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


funcution foo() {

    console.log(this.a);
}

var obj = {
    a: 2,
    foo: foo                    // 无论是直接定义 foo(); 在此，还是先定义后再添加到此
                                // 函数被包裹在对象的上下文中，则此时 this 隐士绑定为 obj
};

obj.foo();                      // a


//-------------------------------------------------------------------------------------------------------------------//

// 隐士丢失: 隐式绑定的函数丢失绑定对象
            传递参数是一个不带修饰的函数调用( 因此使用默认绑定 )

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


function foo() {

    console.log(this.a);
}

var obj = {
    a: 2,
    foo: foo
};

var bar = obj.foo;              // 函数别名

var a = 'oops, global';         // a 是全局对象的属性

bar();                          // 'oops, global'


//-------------------------------------------------------------------------------------------------------------------//

// 显示绑定: 

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


function foo() {

    console.log(a);
}

var obj = {
    a: 2
};

foo.call(obj);                  // 2


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


- 硬绑定: 




//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


- new 绑定


1) 创建/构造 一个全新的对象

2) 这个新对象会被 原型链接

3) 这个新对象会绑定到函数调用的 this

4) 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个对象


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```